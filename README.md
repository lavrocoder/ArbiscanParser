# Arbiscan парсер

Программа для парсинга страницы **Token Transfers** сайта [arbiscan.io](https://arbiscan.io)

### Требования
* `Python3.10` или новее

### Установка
* Запустите файл `bats/install.bat` для автоматического создания виртуального окружения и установки зависимостей.

### Настройка
1. Создайте файл сервисного аккаунта google с доступом к `Google Sheets API`. [Инструкция](https://dzen.ru/video/watch/641da7b09df431794fc1c3dd).
2. Поместите его в папку `config` и переименуйте его на `secret.json`. Должно получиться следующим образом `config/secret.json`.
3. Скопируйте таблицу [Arbiscan Parser](https://docs.google.com/spreadsheets/d/1jIa_ekuK-2QBiGUYbMjrvWypy_PH6p5lSnG_7zEwgGA/) (`Файл` → `Создать копию`).
4. Скопируйте ссылку на новую таблицу.
5. Откройте файл `config/settings.py`.
6. Вставьте ссылку в переменную `MAIN_TABLE` (в кавычках).
7. Откройте файл `config/secret.json`.
8. Скопируйте почту сервисного аккаунта из поля `client_email`.
9. И укажите её в настройках доступа таблицы (из шага 4) в качестве редактора.

### Создание новых таблиц для парсинга
1. Скопируйте таблицу [Шаблон Arbiscan](https://docs.google.com/spreadsheets/d/1gDz6HNn5mBCsitUbj7X_qG9HprOVSTXCGdbB3CjK6ls/).
2. Откройте файл `config/secret.json`.
3. Скопируйте почту сервисного аккаунта из поля `client_email`.
4. И укажите её в настройках доступа таблицы в качестве редактора.

### Работа с основной таблицей
Это основная таблица, в ней указанны ссылки на все используемы в работе таблицы, а также фильтры для парсинга.

На странице `Таблицы` есть несколько столбцов:
1. `Название` - столбец с названием таблицы. В первую очередь для пользователя. Также используется при логирование.
2. `Ссылка на таблицу` - столбец в котором нужно указать ссылку на таблицу для парсинга кошелька (см пункт `Создание новых таблиц для парсинга`).
3. `Статус` - статус последней обработки таблицы.
4. `Кошелёк` - адрес кошелька. Например: `0xf89d7b9c864f589bbF53a82105107622B35EaA40`.
5. `Txn Hash` - фильтр по полю `Txn Hash` (см пункт `Фильтры`).
6. `Date Time (UTC)` - фильтр по полю `Date Time (UTC)` (см пункт `Фильтры`).
7. `From` - фильтр по полю `From` (см пункт `Фильтры`).
8. `Type` - фильтр по не подписанному полю `Type` (см пункт `Фильтры`).
9. `To` - фильтр по полю `To` (см пункт `Фильтры`).
10. `Value` - фильтр по полю `Value` (см пункт `Фильтры`).
11. `Token` - фильтр по полю `Token` (см пункт `Фильтры`).

### Фильтры
* Все фильтры проверяют соответствующий столбец.
* Если столбец равен значению фильтра, то транзакция попадает в таблицу.
* Если фильтр пустой, то он не учитывается.

### Запуск
Для запуска используйте файл `bats/run.bat`.

### Алгоритм работы
1. Не чаще чем раз в минуту программа обрабатывает все таблицы по очереди.
2. Программа получает время последней полученной транзакции в таблице.
3. Парсит все новые транзакции с сайта.
4. Сохраняет полученные данные в таблицу в том же порядке, как и на сайте.

Данный алгоритм позволяет как держать программу постоянно запущенной на сервере, так и запускать время от времени на личном компьютере. 
